<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–®–∫—ñ–ª—å–Ω–µ –º–µ–Ω—é</title>
  <style>
    :root{--bg:#f7fbff;--card:#ffffff;--accent:#0066cc;--muted:#6b7280}
    *{box-sizing:border-box}
    body{font-family:Inter,Segoe UI,Arial; background:var(--bg); margin:0; padding:24px; color:#0f172a}
    .wrap{max-width:980px;margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;gap:12px}
    h1{font-size:20px;margin:0}
    .controls{display:flex;gap:8px;align-items:center}
    button{background:var(--accent);color:white;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
    button.ghost{background:transparent;color:var(--accent);border:1px solid rgba(0,102,204,0.12)}
    button:disabled{opacity:0.6;cursor:not-allowed}
    .date-display{font-weight:700}
    .card{background:var(--card);border-radius:10px;padding:16px;box-shadow:0 6px 18px rgba(12,18,40,0.06)}
    .section-title{font-weight:700;margin-top:14px;margin-bottom:8px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}
    .meal{padding:12px;border-radius:8px;background:#fbfdff;border:1px solid rgba(11,56,110,0.04)}
    .meal h4{margin:0 0 6px 0;font-size:15px}
    .muted{color:var(--muted);font-size:13px}
    .form-row{margin-top:8px}
    textarea,input[type="text"]{width:100%;padding:8px;border-radius:6px;border:1px solid #e6eef8;font-size:14px}
    .status{padding:4px 8px;border-radius:4px;font-size:12px;margin-left:8px}
    .success{background:#d4edda;color:#155724}
    .loading{background:#fff3cd;color:#856404}
    .error{background:#f8d7da;color:#721c24}
    .access-panel{background:#f8f9fa;padding:15px;border-radius:8px;margin-top:15px;border:1px dashed #ccc}
    .user-badge{background:#e7f3ff;padding:4px 8px;border-radius:4px;font-size:12px;margin-left:8px}
    .admin-section{margin-top:30px;padding-top:20px;border-top:1px solid #e6eef8}
    @media(max-width:520px){header{flex-direction:column;align-items:flex-start}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>üçΩÔ∏è –®–∫—ñ–ª—å–Ω–µ –º–µ–Ω—é</h1>
        <div class="muted small">–ü–æ–∫–∞–∑–∞–Ω–æ –º–µ–Ω—é –Ω–∞ <span id="readableDate">...</span> <span id="status" class="status"></span></div>
      </div>
      <div class="controls">
        <button id="prev" class="ghost">‚Üê</button>
        <input type="date" id="date" />
        <button id="next" class="ghost">‚Üí</button>
        <button id="today">–°—å–æ–≥–æ–¥–Ω—ñ</button>
        <button id="refresh">üîÑ –û–Ω–æ–≤–∏—Ç–∏</button>
        <button id="adminToggle" class="ghost">‚öôÔ∏è –î–ª—è –∞–¥–º—ñ–Ω–∞</button>
        <span id="userBadge" class="user-badge" style="display:none">üë§ –ê–¥–º—ñ–Ω</span>
      </div>
    </header>

    <main class="card">
      <!-- –û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–ª—è –≤—Å—ñ—Ö -->
      <div class="section-title">üè´ –ú—ñ—Å—å–∫—ñ –¥—ñ—Ç–∏</div>
      <div id="cityArea" class="grid" aria-live="polite"></div>

      <div class="section-title">üè† –Ü–Ω–æ–≥–æ—Ä–æ–¥–Ω—ñ –¥—ñ—Ç–∏</div>
      <div id="nonCityArea" class="grid" aria-live="polite"></div>

      <!-- –°–µ–∫—Ü—ñ—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–ø—Ä–∏—Ö–æ–≤–∞–Ω–∞ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º) -->
      <div class="admin-section">
        <div style="text-align:center;margin-bottom:15px;">
          <button id="toggleAdminPanel" class="ghost" style="font-size:12px;">üë®‚Äçüè´ –†–æ–∑–¥—ñ–ª –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</button>
        </div>
        
        <div id="accessPanel" class="access-panel" style="display:none">
          <h3>üîê –î–æ—Å—Ç—É–ø –¥–æ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è</h3>
          <div class="form-row">
            <label>–ü–∞—Ä–æ–ª—å –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞:</label>
            <input type="password" id="adminPassword" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å" style="width:100%" />
          </div>
          <button id="loginBtn">üîì –£–≤—ñ–π—Ç–∏</button>
          <div class="muted" style="margin-top:8px;font-size:12px">
            –û—Ç—Ä–∏–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å —É –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –º–µ–Ω—é
          </div>
        </div>

        <!-- –†–µ–¥–∞–∫—Ç–æ—Ä -->
        <div id="editor" style="display:none;margin-top:20px;padding:20px;background:#f8f9fa;border-radius:8px;">
          <h3>‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –º–µ–Ω—é –Ω–∞ <span id="editDateLabel"></span></h3>
          
          <div class="muted" style="margin-bottom:15px;">
            üí° –ó–º—ñ–Ω–∏ –±—É–¥—É—Ç—å –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–ª—è –≤—Å—ñ—Ö –≤—ñ–¥–≤—ñ–¥—É–≤–∞—á—ñ–≤ —Å–∞–π—Ç—É
          </div>
          
          <div class="section-title">üçΩÔ∏è –ú—ñ—Å—å–∫—ñ –¥—ñ—Ç–∏</div>
          <div class="form-row"><label>üç≤ –û–±—ñ–¥</label><textarea id="e_city_lunch" rows="3" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –ë–æ—Ä—â, –∫–æ—Ç–ª–µ—Ç–∞, –ø—é—Ä–µ, –∫–æ–º–ø–æ—Ç"></textarea></div>

          <div class="section-title">üè† –Ü–Ω–æ–≥–æ—Ä–æ–¥–Ω—ñ –¥—ñ—Ç–∏</div>
          <div class="form-row"><label>üç≥ –°–Ω—ñ–¥–∞–Ω–æ–∫</label><textarea id="e_nc_breakfast" rows="2" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –ö–∞—à–∞ –≥—Ä–µ—á–∞–Ω–∞, –±—É—Ç–µ—Ä–±—Ä–æ–¥, —á–∞–π"></textarea></div>
          <div class="form-row"><label>üçé –ü–æ–ª—É–¥–µ–Ω–æ–∫</label><textarea id="e_nc_snack" rows="2" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –Ø–±–ª—É–∫–æ, –ø–µ—á–∏–≤–æ, —Å—ñ–∫"></textarea></div>
          <div class="form-row"><label>üç≤ –û–±—ñ–¥</label><textarea id="e_nc_lunch" rows="3" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –ë–æ—Ä—â, –∫–æ—Ç–ª–µ—Ç–∞, –ø—é—Ä–µ, —Å–∞–ª–∞—Ç"></textarea></div>
          <div class="form-row"><label>ü•õ –ü—ñ–¥–≤–µ—á—ñ—Ä–æ–∫</label><textarea id="e_nc_evening" rows="2" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –ô–æ–≥—É—Ä—Ç, —Ñ—Ä—É–∫—Ç"></textarea></div>
          <div class="form-row"><label>üçõ –í–µ—á–µ—Ä—è</label><textarea id="e_nc_dinner" rows="2" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –û–º–ª–µ—Ç, —Å–∞–ª–∞—Ç, –∫–µ—Ñ—ñ—Ä"></textarea></div>

          <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap;">
            <button id="save">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –¥–ª—è –≤—Å—ñ—Ö</button>
            <button id="cancel" class="ghost">‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏</button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // === –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –î–õ–Ø –ê–î–ú–Ü–ù–Ü–°–¢–†–ê–¢–û–†–ê ===
    const ADMIN_PASSWORD = "school123123";
    const GITHUB_CONFIG = {
      repoOwner: "Pomasvg",       
      repoName: "menu"
    };
    // =======================================

    let currentData = {};
    let isAdmin = false;
    let githubToken = "";

    const dateInput = document.getElementById('date');
    const readableDate = document.getElementById('readableDate');
    const cityArea = document.getElementById('cityArea');
    const nonCityArea = document.getElementById('nonCityArea');
    const editor = document.getElementById('editor');
    const statusEl = document.getElementById('status');
    const accessPanel = document.getElementById('accessPanel');
    const userBadge = document.getElementById('userBadge');

    function isoToday() { return new Date().toISOString().slice(0,10); }
    function niceDate(iso) { return new Date(iso).toLocaleDateString('uk-UA',{year:'numeric',month:'long',day:'numeric'}); }

    function setStatus(text, type = '') {
      statusEl.textContent = text;
      statusEl.className = `status ${type}`;
    }

    // –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ UTF-8 —Ç–∞ base64
    function utf8_to_b64(str) {
      return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, function(match, p1) {
        return String.fromCharCode('0x' + p1);
      }));
    }

    // –ë–µ–∑–ø–µ—á–Ω–µ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞
    async function getGitHubToken() {
      if (githubToken) return githubToken;
      
      // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ localStorage
      const savedToken = localStorage.getItem('github_token');
      if (savedToken) {
        githubToken = savedToken;
        return savedToken;
      }
      
      // –ó–∞–ø–∏—Ç—É—î–º–æ —Ç–æ–∫–µ–Ω —É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
      const token = prompt('üîê –°—é–¥–∏ –≤–≤–µ–¥–∏ —Ç–æ–∫–µ–Ω');
      if (token) {
        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ç–æ–∫–µ–Ω
        const isValid = await validateToken(token);
        if (isValid) {
          githubToken = token;
          localStorage.setItem('github_token', token);
          return token;
        } else {
          alert('‚ùå –ù–µ–≤—ñ—Ä–Ω–∏–π —Ç–æ–∫–µ–Ω! –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å —Ç–∞ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É.');
          localStorage.removeItem('github_token');
          return null;
        }
      }
      
      return null;
    }

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
    async function validateToken(token) {
      try {
        const response = await fetch('https://api.github.com/user', {
          headers: {
            'Authorization': `token ${token}`,
            'Accept': 'application/vnd.github.v3+json'
          }
        });
        return response.ok;
      } catch (error) {
        return false;
      }
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–∞–Ω—ñ –∑ GitHub
    async function loadData() {
      setStatus('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...', 'loading');
      try {
        // –î–ª—è —á–∏—Ç–∞–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ø—É–±–ª—ñ—á–Ω–∏–π –¥–æ—Å—Ç—É–ø
        const url = `https://raw.githubusercontent.com/${GITHUB_CONFIG.repoOwner}/${GITHUB_CONFIG.repoName}/main/menu.json`;
        const response = await fetch(url + '?t=' + Date.now());
        
        if (response.ok) {
          const content = await response.json();
          currentData = content;
          setStatus('–û–Ω–æ–≤–ª–µ–Ω–æ', 'success');
          setTimeout(() => setStatus(''), 3000);
          return true;
        } else if (response.status === 404) {
          // –§–∞–π–ª –Ω–µ —ñ—Å–Ω—É—î - —Ü–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –ø–µ—Ä—à–æ–≥–æ –∑–∞–ø—É—Å–∫—É
          currentData = {};
          setStatus('–ú–µ–Ω—é —â–µ –Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–µ', 'success');
          return true;
        } else {
          throw new Error(`–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è: ${response.status}`);
        }
      } catch (error) {
        setStatus('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è', 'error');
        console.error('–ü–æ–º–∏–ª–∫–∞:', error);
        return false;
      }
    }

    // –ó–±–µ—Ä–µ–≥—Ç–∏ –¥–∞–Ω—ñ –Ω–∞ GitHub
    async function saveData() {
      const token = await getGitHubToken();
      if (!token) {
        setStatus('–ü–æ—Ç—Ä—ñ–±–µ–Ω —Ç–æ–∫–µ–Ω –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è', 'error');
        return false;
      }

      setStatus('–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è...', 'loading');
      try {
        const url = `https://api.github.com/repos/${GITHUB_CONFIG.repoOwner}/${GITHUB_CONFIG.repoName}/contents/menu.json`;
        
        // –°–ø–æ—á–∞—Ç–∫—É –æ—Ç—Ä–∏–º—É—î–º–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ñ–∞–π–ª (—è–∫—â–æ –≤—ñ–Ω —ñ—Å–Ω—É—î)
        let sha = '';
        try {
          const getResponse = await fetch(url, {
            headers: {
              'Authorization': `token ${token}`,
              'Accept': 'application/vnd.github.v3+json'
            }
          });
          
          if (getResponse.status === 401) {
            throw new Error('–ù–µ–≤—ñ—Ä–Ω–∏–π —Ç–æ–∫–µ–Ω. –°–ø—Ä–æ–±—É–π—Ç–µ –≤–≤–µ—Å—Ç–∏ —Ç–æ–∫–µ–Ω –∑–Ω–æ–≤—É.');
          }
          
          if (getResponse.ok) {
            const fileData = await getResponse.json();
            sha = fileData.sha;
          } else if (getResponse.status !== 404) {
            throw new Error(`–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ñ–∞–π–ª—É: ${getResponse.status}`);
          }
        } catch (error) {
          if (error.message.includes('–ù–µ–≤—ñ—Ä–Ω–∏–π —Ç–æ–∫–µ–Ω')) {
            // –í–∏–¥–∞–ª—è—î–º–æ –Ω–µ–≤—ñ—Ä–Ω–∏–π —Ç–æ–∫–µ–Ω
            localStorage.removeItem('github_token');
            githubToken = "";
            throw error;
          }
          // –î–ª—è 404 –ø–æ–º–∏–ª–∫–∏ –ø—Ä–æ–¥–æ–≤–∂—É—î–º–æ (—Ñ–∞–π–ª –Ω–µ —ñ—Å–Ω—É—î)
          if (!error.message.includes('404')) {
            throw error;
          }
        }

        // –ö–æ–¥—É—î–º–æ –¥–∞–Ω—ñ –¥–ª—è GitHub
        const jsonString = JSON.stringify(currentData, null, 2);
        const content = utf8_to_b64(jsonString);
        
        const response = await fetch(url, {
          method: 'PUT',
          headers: {
            'Authorization': `token ${token}`,
            'Accept': 'application/vnd.github.v3+json',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            message: `–û–Ω–æ–≤–ª–µ–Ω–Ω—è –º–µ–Ω—é –∑–∞ ${dateInput.value}`,
            content: content,
            sha: sha || undefined
          })
        });

        if (response.ok) {
          setStatus('–ó–±–µ—Ä–µ–∂–µ–Ω–æ –¥–ª—è –≤—Å—ñ—Ö!', 'success');
          setTimeout(() => setStatus(''), 3000);
          return true;
        } else {
          const errorData = await response.json();
          
          if (response.status === 401) {
            localStorage.removeItem('github_token');
            githubToken = "";
            throw new Error('–¢–æ–∫–µ–Ω –Ω–µ–¥—ñ–π—Å–Ω–∏–π. –°–ø—Ä–æ–±—É–π—Ç–µ –≤–≤–µ—Å—Ç–∏ –Ω–æ–≤–∏–π —Ç–æ–∫–µ–Ω.');
          } else if (response.status === 403) {
            throw new Error('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –ø—Ä–∞–≤. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ —Ç–æ–∫–µ–Ω –º–∞—î –ø—Ä–∞–≤–∞ "repo".');
          } else if (response.status === 404) {
            throw new Error('–†–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ repoOwner —Ç–∞ repoName.');
          } else {
            throw new Error(errorData.message || `–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è: ${response.status}`);
          }
        }
      } catch (error) {
        setStatus(`–ü–æ–º–∏–ª–∫–∞: ${error.message}`, 'error');
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è:', error);
        
        // –Ø–∫—â–æ –ø–æ–º–∏–ª–∫–∞ —Ç–æ–∫–µ–Ω–∞, –ø—Ä–æ–ø–æ–Ω—É—î–º–æ –≤–≤–µ—Å—Ç–∏ –Ω–æ–≤–∏–π
        if (error.message.includes('—Ç–æ–∫–µ–Ω') || error.message.includes('–ø—Ä–∞–≤')) {
          setTimeout(() => {
            localStorage.removeItem('github_token');
            githubToken = "";
            getGitHubToken(); // –ó–∞–ø–∏—Ç—É—î–º–æ –Ω–æ–≤–∏–π —Ç–æ–∫–µ–Ω
          }, 2000);
        }
        
        return false;
      }
    }

    // –í—ñ–¥–æ–±—Ä–∞–∑–∏—Ç–∏ –º–µ–Ω—é
    function renderForDate(iso) {
      if (!iso) iso = dateInput.value || isoToday();
      readableDate.textContent = niceDate(iso);
      const day = currentData[iso] || { city: { lunch: '' }, nonCity: { breakfast:'', snack:'', lunch:'', evening:'', dinner:'' } };

      cityArea.innerHTML = '';
      const cityLunchCard = document.createElement('div');
      cityLunchCard.className = 'meal';
      cityLunchCard.innerHTML = `<h4>üçΩÔ∏è –û–±—ñ–¥</h4><div>${day.city.lunch || '‚Äî'}</div>`;
      cityArea.appendChild(cityLunchCard);

      nonCityArea.innerHTML = '';
      const fields = [
        ['üç≥ –°–Ω—ñ–¥–∞–Ω–æ–∫', day.nonCity.breakfast],
        ['üçé –ü–æ–ª—É–¥–µ–Ω–æ–∫', day.nonCity.snack],
        ['üç≤ –û–±—ñ–¥', day.nonCity.lunch],
        ['ü•õ –ü—ñ–¥–≤–µ—á—ñ—Ä–æ–∫', day.nonCity.evening],
        ['üçõ –í–µ—á–µ—Ä—è', day.nonCity.dinner]
      ];
      
      fields.forEach(([title, val]) => {
        const div = document.createElement('div');
        div.className = 'meal';
        div.innerHTML = `<h4>${title}</h4><div>${val || '‚Äî'}</div>`;
        nonCityArea.appendChild(div);
      });
    }

    // –ù–∞–≤—ñ–≥–∞—Ü—ñ—è
    document.getElementById('today').addEventListener('click', () => {
      dateInput.value = isoToday();
      renderForDate(dateInput.value);
    });

    document.getElementById('prev').addEventListener('click', () => changeDateBy(-1));
    document.getElementById('next').addEventListener('click', () => changeDateBy(1));
    document.getElementById('refresh').addEventListener('click', () => loadData().then(() => renderForDate(dateInput.value)));

    function changeDateBy(delta) {
      const cur = new Date(dateInput.value || isoToday());
      cur.setDate(cur.getDate() + delta);
      const iso = cur.toISOString().slice(0,10);
      dateInput.value = iso;
      renderForDate(iso);
    }

    dateInput.addEventListener('change', () => renderForDate(dateInput.value));

    // –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–æ—Å—Ç—É–ø–æ–º
    document.getElementById('toggleAdminPanel').addEventListener('click', () => {
      accessPanel.style.display = accessPanel.style.display === 'none' ? 'block' : 'none';
    });

    document.getElementById('adminToggle').addEventListener('click', () => {
      document.querySelector('.admin-section').scrollIntoView({ behavior: 'smooth' });
      accessPanel.style.display = 'block';
    });

    document.getElementById('loginBtn').addEventListener('click', () => {
      const password = document.getElementById('adminPassword').value;
      if (password === ADMIN_PASSWORD) {
        isAdmin = true;
        accessPanel.style.display = 'none';
        userBadge.style.display = 'inline-block';
        document.getElementById('adminToggle').textContent = '‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏';
        alert('‚úÖ –í–∏ —É–≤—ñ–π—à–ª–∏ —è–∫ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä! –¢–µ–ø–µ—Ä –≤–∏ –º–æ–∂–µ—Ç–µ —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ –º–µ–Ω—é.');
      } else {
        alert('‚ùå –ù–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å! –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —à–∫–æ–ª–∏.');
      }
    });

    // –†–µ–¥–∞–∫—Ç–æ—Ä
    document.getElementById('adminToggle').addEventListener('click', () => {
      if (!isAdmin) {
        document.querySelector('.admin-section').scrollIntoView({ behavior: 'smooth' });
        accessPanel.style.display = 'block';
        return;
      }
      openEditorFor(dateInput.value || isoToday());
    });

    function openEditorFor(iso) {
      const day = currentData[iso] || { city: { lunch: '' }, nonCity: { breakfast:'', snack:'', lunch:'', evening:'', dinner:'' } };
      
      document.getElementById('e_city_lunch').value = day.city.lunch || '';
      document.getElementById('e_nc_breakfast').value = day.nonCity.breakfast || '';
      document.getElementById('e_nc_snack').value = day.nonCity.snack || '';
      document.getElementById('e_nc_lunch').value = day.nonCity.lunch || '';
      document.getElementById('e_nc_evening').value = day.nonCity.evening || '';
      document.getElementById('e_nc_dinner').value = day.nonCity.dinner || '';
      document.getElementById('editDateLabel').textContent = niceDate(iso);
      editor.style.display = 'block';
      editor.scrollIntoView({ behavior: 'smooth' });
    }

    document.getElementById('cancel').addEventListener('click', () => {
      editor.style.display = 'none';
    });

    document.getElementById('save').addEventListener('click', async () => {
      const iso = dateInput.value || isoToday();
      
      currentData[iso] = {
        city: { lunch: document.getElementById('e_city_lunch').value.trim() },
        nonCity: {
          breakfast: document.getElementById('e_nc_breakfast').value.trim(),
          snack: document.getElementById('e_nc_snack').value.trim(),
          lunch: document.getElementById('e_nc_lunch').value.trim(),
          evening: document.getElementById('e_nc_evening').value.trim(),
          dinner: document.getElementById('e_nc_dinner').value.trim()
        }
      };

      const success = await saveData();
      if (success) {
        renderForDate(iso);
        editor.style.display = 'none';
      }
    });

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 60 —Å–µ–∫—É–Ω–¥
    setInterval(() => {
      loadData().then(() => renderForDate(dateInput.value));
    }, 60000);

    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
    (async function init() {
      dateInput.value = isoToday();
      await loadData();
      renderForDate(dateInput.value);
    })();
  </script>
</body>
</html>
