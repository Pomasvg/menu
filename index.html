<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Шкільне меню</title>
  <style>
    :root{--bg:#f7fbff;--card:#ffffff;--accent:#0066cc;--muted:#6b7280}
    *{box-sizing:border-box}
    body{font-family:Inter,Segoe UI,Arial; background:var(--bg); margin:0; padding:24px; color:#0f172a}
    .wrap{max-width:980px;margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;gap:12px}
    h1{font-size:20px;margin:0}
    .controls{display:flex;gap:8px;align-items:center}
    button{background:var(--accent);color:white;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
    button.ghost{background:transparent;color:var(--accent);border:1px solid rgba(0,102,204,0.12)}
    .date-display{font-weight:700}
    .card{background:var(--card);border-radius:10px;padding:16px;box-shadow:0 6px 18px rgba(12,18,40,0.06)}
    .section-title{font-weight:700;margin-top:14px;margin-bottom:8px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}
    .meal{padding:12px;border-radius:8px;background:#fbfdff;border:1px solid rgba(11,56,110,0.04)}
    .meal h4{margin:0 0 6px 0;font-size:15px}
    .muted{color:var(--muted);font-size:13px}
    .form-row{margin-top:8px}
    textarea,input[type="text"]{width:100%;padding:8px;border-radius:6px;border:1px solid #e6eef8;font-size:14px}
    .tools{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    footer{margin-top:18px;color:var(--muted);font-size:13px}
    @media(max-width:520px){header{flex-direction:column;align-items:flex-start}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Шкільне меню</h1>
        <div class="muted small">Показано меню на <span id="readableDate">...</span></div>
      </div>
      <div class="controls">
        <button id="prev" class="ghost">←</button>
        <input type="date" id="date" />
        <button id="next" class="ghost">→</button>
        <button id="today">Сьогодні</button>
        <button id="login" class="ghost">Адмін</button>
      </div>
    </header>

    <main class="card">
      <div class="section-title">Міські діти</div>
      <div id="cityArea" class="grid" aria-live="polite"></div>

      <div class="section-title">Іногородні діти</div>
      <div id="nonCityArea" class="grid" aria-live="polite"></div>

      <div id="editor" style="display:none;margin-top:14px" class="card">
        <h3>Редагувати меню на <span id="editDateLabel"></span></h3>

        <div class="section-title">Міські діти</div>
        <div class="form-row"><label>Обід</label><textarea id="e_city_lunch"></textarea></div>

        <div class="section-title">Іногородні діти</div>
        <div class="form-row"><label>Сніданок</label><textarea id="e_nc_breakfast"></textarea></div>
        <div class="form-row"><label>Полуденок</label><textarea id="e_nc_snack"></textarea></div>
        <div class="form-row"><label>Обід</label><textarea id="e_nc_lunch"></textarea></div>
        <div class="form-row"><label>Підвечірок</label><textarea id="e_nc_evening"></textarea></div>
        <div class="form-row"><label>Вечеря</label><textarea id="e_nc_dinner"></textarea></div>

        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="save">Зберегти</button>
          <button id="cancel" class="ghost">Скасувати</button>
          <button id="delete" class="ghost">Видалити цей день</button>
        </div>
      </div>
    </main>
  </div>

  <script>
    const STORAGE_KEY = 'school_menu_db_v1';
    let db = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');

    const dateInput = document.getElementById('date');
    const readableDate = document.getElementById('readableDate');
    const cityArea = document.getElementById('cityArea');
    const nonCityArea = document.getElementById('nonCityArea');
    const editor = document.getElementById('editor');

    const e_city_lunch = document.getElementById('e_city_lunch');
    const e_nc_breakfast = document.getElementById('e_nc_breakfast');
    const e_nc_snack = document.getElementById('e_nc_snack');
    const e_nc_lunch = document.getElementById('e_nc_lunch');
    const e_nc_evening = document.getElementById('e_nc_evening');
    const e_nc_dinner = document.getElementById('e_nc_dinner');

    const editDateLabel = document.getElementById('editDateLabel');

    function isoToday(){ return new Date().toISOString().slice(0,10); }
    function niceDate(iso){ return new Date(iso).toLocaleDateString('uk-UA',{year:'numeric',month:'long',day:'numeric'}); }

    function ensureDateInput(){ if(!dateInput.value){ dateInput.value = isoToday(); } }

    function renderForDate(iso){
      if(!iso) iso = dateInput.value || isoToday();
      readableDate.textContent = niceDate(iso);
      const day = db[iso] || { city: { lunch: '' }, nonCity: { breakfast:'', snack:'', lunch:'', evening:'', dinner:'' } };

      cityArea.innerHTML = '';
      const cityLunchCard = document.createElement('div'); cityLunchCard.className='meal';
      cityLunchCard.innerHTML = `<h4>Обід</h4><div>${day.city.lunch || '—'}</div>`;
      cityArea.appendChild(cityLunchCard);

      nonCityArea.innerHTML = '';
      const fields = [ ['Сніданок', day.nonCity.breakfast], ['Полуденок', day.nonCity.snack], ['Обід', day.nonCity.lunch], ['Підвечірок', day.nonCity.evening], ['Вечеря', day.nonCity.dinner] ];
      for(const [title, val] of fields){
        const div = document.createElement('div'); div.className='meal';
        div.innerHTML = `<h4>${title}</h4><div>${val || '—'}</div>`;
        nonCityArea.appendChild(div);
      }
    }

    function saveDB(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(db)); }

    document.getElementById('today').addEventListener('click', ()=>{ dateInput.value = isoToday(); renderForDate(dateInput.value); });
    document.getElementById('prev').addEventListener('click', ()=>{ changeDateBy(-1); });
    document.getElementById('next').addEventListener('click', ()=>{ changeDateBy(1); });

    function changeDateBy(delta){ const cur = new Date(dateInput.value || isoToday()); cur.setDate(cur.getDate() + delta); const iso = cur.toISOString().slice(0,10); dateInput.value = iso; renderForDate(iso); }

    dateInput.addEventListener('change', ()=> renderForDate(dateInput.value));

    let isAdmin = false;
    document.getElementById('login').addEventListener('click', ()=>{
      if(isAdmin){ isAdmin=false; document.getElementById('login').textContent='Адмін'; editor.style.display='none'; return; }
      const pass = prompt('Введіть пароль адміністратора');
      if(pass === '333333333333'){ isAdmin=true; document.getElementById('login').textContent='Вийти'; openEditorFor(dateInput.value || isoToday()); }
      else if(pass === null){  } else { alert('Невірний пароль'); }
    });

    function openEditorFor(iso){ if(!isAdmin){ alert('Потрібен доступ адміністратора'); return; }
      const day = db[iso] || { city: { lunch: '' }, nonCity: { breakfast:'', snack:'', lunch:'', evening:'', dinner:'' } };
      e_city_lunch.value = day.city.lunch || '';
      e_nc_breakfast.value = day.nonCity.breakfast || '';
      e_nc_snack.value = day.nonCity.snack || '';
      e_nc_lunch.value = day.nonCity.lunch || '';
      e_nc_evening.value = day.nonCity.evening || '';
      e_nc_dinner.value = day.nonCity.dinner || '';
      editDateLabel.textContent = niceDate(iso);
      editor.style.display = 'block';
    }

    document.getElementById('date').addEventListener('dblclick', ()=>{ if(isAdmin) openEditorFor(dateInput.value || isoToday()); });

    document.getElementById('save').addEventListener('click', ()=>{
      if(!isAdmin){ alert('Потрібен доступ адміністратора'); return; }
      const iso = dateInput.value || isoToday();
      db[iso] = {
        city: { lunch: e_city_lunch.value.trim() },
        nonCity: {
          breakfast: e_nc_breakfast.value.trim(),
          snack: e_nc_snack.value.trim(),
          lunch: e_nc_lunch.value.trim(),
          evening: e_nc_evening.value.trim(),
          dinner: e_nc_dinner.value.trim()
        }
      };
      saveDB();
      renderForDate(iso);
      editor.style.display='none';
      alert('Збережено');
    });

    document.getElementById('cancel').addEventListener('click', ()=>{ editor.style.display='none'; });

    document.getElementById('delete').addEventListener('click', ()=>{
      if(!isAdmin) return alert('Потрібен доступ адміністратора');
      const iso = dateInput.value || isoToday();
      if(confirm('Видалити меню для ' + niceDate(iso) + '?')){ delete db[iso]; saveDB(); renderForDate(iso); editor.style.display='none'; }
    });

    (function init(){ dateInput.value = isoToday(); renderForDate(dateInput.value); })();
  </script>
</body>
</html>